package com.example;

import javax.servlet.http.HttpServletRequest;
import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.SAXParserFactory;
import org.xml.sax.InputSource;
import java.io.StringReader;

public class XxeVulnerability {
    
    // CWE-611: XML External Entity (XXE) vulnerability
    public void parseXmlDocument(HttpServletRequest request) throws Exception {
        String xmlContent = request.getParameter("xml");
        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
        DocumentBuilder builder = factory.newDocumentBuilder();
        builder.parse(new InputSource(new StringReader(xmlContent)));
    }
    
    // CWE-611: XXE via SAX parser
    public void parseSaxXml(String xmlData) throws Exception {
        SAXParserFactory factory = SAXParserFactory.newInstance();
        factory.newSAXParser().parse(new InputSource(new StringReader(xmlData)), null);
    }
    
    // CWE-611: XXE with external DTD processing
    public void parseXmlWithDtd(String xml) throws Exception {
        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        dbf.setValidating(true);
        DocumentBuilder db = dbf.newDocumentBuilder();
        db.parse(new InputSource(new StringReader(xml)));
    }
}